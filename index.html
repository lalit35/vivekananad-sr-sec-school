<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Competition Registration</title>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">

<style>
body {
    font-family: 'Poppins', sans-serif;
    margin: 0;
    background: linear-gradient(135deg, #6a82fb, #fc5c7d);
}
.header {
    text-align: center;
    padding: 50px 20px;
    background-color: #4b79a1;
    color: white;
}
.container {
    width: 80%;
    max-width: 950px;
    margin: auto;
    padding: 40px;
    background: white;
    border-radius: 15px;
}
.form-title {
    text-align: center;
    font-size: 2.5em;
    margin-bottom: 40px;
}
.step-container { display:none; }
.step-container.active { display:block; }
label { font-weight:bold; margin-bottom:10px; display:block; }
input, select, button {
    width:100%;
    padding:14px;
    margin-bottom:20px;
}
button {
    background:#fc5c7d;
    color:white;
    border:none;
    border-radius:8px;
    cursor:pointer;
}
#frontCameraStream { display:none; width:100%; }
#loadingSpinner {
    display:none;
    position:fixed;
    top:50%; left:50%;
    width:50px; height:50px;
    border:6px solid #eee;
    border-top:6px solid #fc5c7d;
    border-radius:50%;
    animation: spin 1s linear infinite;
    transform: translate(-50%, -50%);
}
@keyframes spin { to { transform: rotate(360deg); } }

/* ðŸŽ‰ Congratulations Animation */
#congratsScreen {
    display:none;
    position:fixed;
    top:0; left:0;
    width:100%;
    height:100%;
    background: linear-gradient(135deg, #43cea2, #185a9d);
    color:white;
    text-align:center;
    padding-top:150px;
    z-index:9999;
}
#congratsScreen h1 {
    font-size:3em;
    animation: pop 1s ease-in-out infinite alternate;
}
#congratsScreen p {
    font-size:1.3em;
}
@keyframes pop {
    from { transform: scale(1); }
    to { transform: scale(1.1); }
}
.confetti {
    font-size:3em;
    animation: fall 3s linear infinite;
}
@keyframes fall {
    from { transform: translateY(-100px); opacity:1; }
    to { transform: translateY(600px); opacity:0; }
}
</style>
</head>

<body>

<div class="header">
  <h1>VIVEKANAND SR. SEC. SCHOOL</h1>
</div>

<form class="container" id="registrationForm">

<h2 class="form-title">Competition Exam Registration 2025â€“26</h2>

<!-- STEP 1 -->
<div class="step-container active" id="step1">
  <button type="button" id="cameraButton">Capture Photo Now</button>
  <button type="button" id="switchCameraButton">Switch Camera</button>

  <video id="frontCameraStream" autoplay></video>
  <canvas id="photoCanvas" width="640" height="480" style="display:none;"></canvas>
  <input type="hidden" id="capturedPhoto">

  <button type="button" id="captureButton" style="display:none;">Capture Photo</button>
  <div id="photoSuccessMessage" style="display:none;color:green;">Photo captured!</div>
  <button type="button" id="nextButtonStep1" style="display:none;" onclick="nextStep(2)">Next</button>
</div>

<!-- STEP 2 -->
<div class="step-container" id="step2">
  <label>First Name</label>
  <input id="firstName" required>

  <label>Last Name</label>
  <input id="lastName" required>

  <label>DOB</label>
  <input type="date" id="dob" required>

  <label>Class</label>
  <select id="studentClass" required>
    <option value="">Select</option>
    <option>5</option><option>6</option><option>7</option>
    <option>8</option><option>9</option><option>10</option><option>11</option>
  </select>

  <label>City</label>
  <input id="city" required>

  <button type="button" onclick="nextStep(3)">Next</button>
</div>

<!-- STEP 3 -->
<div class="step-container" id="step3">
  <label>Father Name</label>
  <input id="fatherName" required>

  <label>Mother Name</label>
  <input id="motherName" required>

  <button type="button" onclick="nextStep(4)">Next</button>
</div>

<!-- STEP 4 -->
<div class="step-container" id="step4">
  <label>Whatsapp Number</label>
  <input id="mobileNumber" type="tel" pattern="[0-9]{10}" required>

  <label>Email</label>
  <input id="email" type="email" required>

  <button type="submit">Submit</button>
</div>

</form>

<div id="loadingSpinner"></div>

<!-- ðŸŽ‰ Congratulations Screen -->
<div id="congratsScreen">
  <div class="confetti">ðŸŽ‰ðŸŽŠâœ¨ðŸŽ‰ðŸŽŠ</div>
  <h1>Congratulations!</h1>
  <p>Your registration is successful</p>
  <p>Redirecting to payment page...</p>
</div>

<script>
let currentStream;
let facingMode = "user";

cameraButton.onclick = startCamera;
switchCameraButton.onclick = () => {
  facingMode = facingMode === "user" ? "environment" : "user";
  startCamera();
};

async function startCamera() {
  if (currentStream) currentStream.getTracks().forEach(t => t.stop());
  currentStream = await navigator.mediaDevices.getUserMedia({ video:{ facingMode } });
  frontCameraStream.srcObject = currentStream;
  frontCameraStream.style.display = "block";
  captureButton.style.display = "block";
}

captureButton.onclick = () => {
  photoCanvas.getContext("2d").drawImage(frontCameraStream,0,0,photoCanvas.width,photoCanvas.height);
  capturedPhoto.value = photoCanvas.toDataURL();
  frontCameraStream.style.display="none";
  captureButton.style.display="none";
  photoSuccessMessage.style.display="block";
  nextButtonStep1.style.display="block";
};

function nextStep(n){
  document.querySelector(".step-container.active").classList.remove("active");
  document.getElementById("step"+n).classList.add("active");
}

registrationForm.onsubmit = function(e){
  e.preventDefault();
  loadingSpinner.style.display="block";

  fetch("https://script.google.com/macros/s/AKfycbzPYMe8zfzmhZRHmmNipYR-h19K3z6z77nxOU90idn-8Dqb7Pf8b1XNuZ661zH2_46v/exec",{
    method:"POST",
    body:JSON.stringify({
      firstName:firstName.value,
      lastName:lastName.value,
      dob:dob.value,
      studentClass:studentClass.value,
      city:city.value,
      fatherName:fatherName.value,
      motherName:motherName.value,
      mobileNumber:mobileNumber.value,
      email:email.value,
      photo:capturedPhoto.value
    })
  })
  .then(r => r.json())
  .then(() => {
    loadingSpinner.style.display="none";
    congratsScreen.style.display="block";

    setTimeout(() => {
      window.location.href =
        `https://lalit35.github.io/vivekananad-sr-sec-school/payment.html?fname=${encodeURIComponent(firstName.value)}&email=${encodeURIComponent(email.value)}&mobile=${encodeURIComponent(mobileNumber.value)}`;
    }, 3000);
  });
};
</script>

</body>
</html>
