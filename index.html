<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Competition Registration</title>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">

<style>
/* SAME CSS â€” UNCHANGED */
body {
    font-family: 'Poppins', sans-serif;
    margin: 0;
    background: linear-gradient(135deg, #6a82fb, #fc5c7d);
}
.header {
    text-align: center;
    padding: 50px 20px;
    background-color: #4b79a1;
    color: white;
}
.container {
    width: 80%;
    max-width: 950px;
    margin: auto;
    padding: 40px;
    background: white;
    border-radius: 15px;
}
.form-title {
    text-align: center;
    font-size: 2.5em;
    margin-bottom: 40px;
}
.step-container { display:none; }
.step-container.active { display:block; }
label { font-weight:bold; margin-bottom:10px; display:block; }
input, select, button {
    width:100%;
    padding:14px;
    margin-bottom:20px;
}
button {
    background:#fc5c7d;
    color:white;
    border:none;
    border-radius:8px;
}
#frontCameraStream { display:none; width:100%; }
#loadingSpinner {
    display:none;
    position:fixed;
    top:50%; left:50%;
    width:50px; height:50px;
    border:6px solid #eee;
    border-top:6px solid #fc5c7d;
    border-radius:50%;
    animation: spin 1s linear infinite;
}
@keyframes spin { to { transform: rotate(360deg); } }
#successMessage {
    color:green;
    font-size:1.3em;
    text-align:center;
}
</style>
</head>

<body>

<div class="header">
<h1 class="school-name">VIVEKANAND SR. SEC. SCHOOL</h1>
</div>

<form class="container" id="registrationForm">

<h2 class="form-title">Competition Exam Registration 2025-26</h2>

<!-- STEP 1 -->
<div class="step-container active" id="step1">
<button type="button" id="cameraButton">Capture Photo Now</button>
<button type="button" id="switchCameraButton">Switch Camera</button>

<video id="frontCameraStream" autoplay></video>
<canvas id="photoCanvas" width="640" height="480" style="display:none;"></canvas>
<input type="hidden" id="capturedPhoto">

<button type="button" id="captureButton" style="display:none;">Capture Photo</button>
<div id="photoSuccessMessage" style="display:none;color:green;">Photo captured!</div>
<button type="button" id="nextButtonStep1" style="display:none;" onclick="nextStep(2)">Next</button>
</div>

<!-- STEP 2 -->
<div class="step-container" id="step2">
<label>First Name</label>
<input id="firstName" required>

<label>Last Name</label>
<input id="lastName" required>

<label>DOB</label>
<input type="date" id="dob" required>

<label>Class</label>
<select id="studentClass" required>
<option value="">Select</option>
<option>5</option><option>6</option><option>7</option>
<option>8</option><option>9</option><option>10</option><option>11</option>
</select>

<label>City</label>
<input id="city" required>

<button type="button" onclick="nextStep(3)">Next</button>
</div>

<!-- STEP 3 -->
<div class="step-container" id="step3">
<label>Father Name</label>
<input id="fatherName" required>

<label>Mother Name</label>
<input id="motherName" required>

<button type="button" onclick="nextStep(4)">Next</button>
</div>

<!-- STEP 4 -->
<div class="step-container" id="step4">
<label>Whatsapp Number</label>
<input id="mobileNumber" type="tel" pattern="[0-9]{10}" required>

<label>Email</label>
<input id="email" type="email" required>

<button type="submit">Submit</button>
</div>

<div id="successMessage"></div>
</form>

<div id="loadingSpinner"></div>

<script>
const video = document.getElementById("frontCameraStream");
const canvas = document.getElementById("photoCanvas");
const cameraBtn = document.getElementById("cameraButton");
const captureBtn = document.getElementById("captureButton");
const switchBtn = document.getElementById("switchCameraButton");

let currentStream;
let facingMode = "user";

cameraBtn.onclick = startCamera;
switchBtn.onclick = () => { facingMode = facingMode==="user"?"environment":"user"; startCamera(); };

async function startCamera() {
  if (currentStream) currentStream.getTracks().forEach(t=>t.stop());
  currentStream = await navigator.mediaDevices.getUserMedia({ video:{ facingMode } });
  video.srcObject = currentStream;
  video.style.display="block";
  captureBtn.style.display="block";
}

captureBtn.onclick = () => {
  canvas.getContext("2d").drawImage(video,0,0,canvas.width,canvas.height);
  capturedPhoto.value = canvas.toDataURL();
  video.style.display="none";
  captureBtn.style.display="none";
  photoSuccessMessage.style.display="block";
  nextButtonStep1.style.display="block";
};

function nextStep(n){
  document.querySelector(".step-container.active").classList.remove("active");
  document.getElementById("step"+n).classList.add("active");
}

registrationForm.onsubmit = function(e){
  e.preventDefault();
  loadingSpinner.style.display="block";

  fetch("https://script.google.com/macros/s/AKfycbxYzCGX1QhlpBHqHPVsxhw4l1Brh1cxxzszAZM3l3j2TU0jIdxERBrGgxvDSS3ijijH/exec",{
    method:"POST",
    body:JSON.stringify({
      firstName:firstName.value,
      lastName:lastName.value,
      dob:dob.value,
      studentClass:studentClass.value,
      city:city.value,
      fatherName:fatherName.value,
      motherName:motherName.value,
      mobileNumber:mobileNumber.value,
      email:email.value,
      photo:capturedPhoto.value
    })
  })
  .then(r=>r.json())
  .then(()=>{
    loadingSpinner.style.display="none";
    successMessage.innerText="Registration Successful! Email Sent.";
    successMessage.style.display="block";
    registrationForm.reset();
  });
};
</script>

</body>
</html>
