<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Competition Registration</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">

<style>
body {
  font-family: 'Poppins', sans-serif;
  margin: 0;
  background: linear-gradient(135deg, #6a82fb, #fc5c7d);
}
.header {
  text-align: center;
  padding: 40px;
  background: #4b79a1;
  color: #fff;
}
.container {
  width: 85%;
  max-width: 950px;
  margin: 30px auto;
  padding: 35px;
  background: #fff;
  border-radius: 15px;
}
.form-title {
  text-align: center;
  font-size: 2.2em;
  margin-bottom: 30px;
}
.step-container { display:none; }
.step-container.active { display:block; }

label { font-weight:600; display:block; margin-bottom:8px; }
input, select, button {
  width:100%;
  padding:12px;
  margin-bottom:18px;
}
button {
  background:#fc5c7d;
  color:white;
  border:none;
  border-radius:8px;
  cursor:pointer;
}

#frontCameraStream { display:none; width:100%; border-radius:10px; }
#loadingSpinner {
  display:none;
  position:fixed;
  top:50%; left:50%;
  width:50px; height:50px;
  border:6px solid #eee;
  border-top:6px solid #fc5c7d;
  border-radius:50%;
  animation: spin 1s linear infinite;
  transform: translate(-50%, -50%);
}
@keyframes spin { to { transform: rotate(360deg); } }

#congratsScreen {
  display:none;
  position:fixed;
  inset:0;
  background:linear-gradient(135deg,#43cea2,#185a9d);
  color:#fff;
  text-align:center;
  padding-top:150px;
  z-index:9999;
}
</style>
</head>

<body>

<div class="header">
  <h1>VIVEKANAND SR. SEC. SCHOOL</h1>
</div>

<form class="container" id="registrationForm">
<h2 class="form-title">Competition Exam Registration 2025â€“26</h2>

<!-- STEP 1 CAMERA -->
<div class="step-container active" id="step1">
  <button type="button" id="cameraButton">Start Camera</button>
  <button type="button" id="switchCameraButton">Switch Camera</button>

  <video id="frontCameraStream" autoplay></video>
  <canvas id="photoCanvas" width="640" height="480" style="display:none;"></canvas>
  <input type="hidden" id="capturedPhoto">

  <button type="button" id="captureButton" style="display:none;">Capture Photo</button>
  <button type="button" id="nextButtonStep1" style="display:none;">Next</button>
</div>

<!-- STEP 2 BASIC INFO -->
<div class="step-container" id="step2">
  <label>First Name</label>
  <input id="firstName" required>

  <label>Last Name</label>
  <input id="lastName" required>

  <label>Date of Birth</label>
  <input type="date" id="dob" required>

  <label>Age</label>
  <input type="number" id="age" required>

  <label>Class</label>
  <select id="studentClass" required>
    <option value="">Select</option>
    <option>5</option><option>6</option><option>7</option>
    <option>8</option><option>9</option><option>10</option><option>11</option>
  </select>

  <label>Current School / City</label>
  <input id="city" required>

  <button type="button" onclick="nextStep(3)">Next</button>
</div>

<!-- STEP 3 PARENTS -->
<div class="step-container" id="step3">
  <label>Father Name</label>
  <input id="fatherName" required>

  <label>Mother Name</label>
  <input id="motherName" required>

  <button type="button" onclick="nextStep(4)">Next</button>
</div>

<!-- STEP 4 CONTACT -->
<div class="step-container" id="step4">
  <label>Whatsapp Number</label>
  <input id="mobileNumber" pattern="[0-9]{10}" required>

  <label>Email</label>
  <input id="email" type="email" required>

  <button type="submit">Submit</button>
</div>
</form>

<div id="loadingSpinner"></div>

<div id="congratsScreen">
  <h1>ðŸŽ‰ Congratulations!</h1>
  <p>Registration Successful</p>
  <p>Redirecting to paymentâ€¦</p>
</div>

<script>
const cameraButton = document.getElementById("cameraButton");
const switchCameraButton = document.getElementById("switchCameraButton");
const frontCameraStream = document.getElementById("frontCameraStream");
const captureButton = document.getElementById("captureButton");
const nextButtonStep1 = document.getElementById("nextButtonStep1");
const photoCanvas = document.getElementById("photoCanvas");
const capturedPhoto = document.getElementById("capturedPhoto");
const loadingSpinner = document.getElementById("loadingSpinner");
const congratsScreen = document.getElementById("congratsScreen");

let currentStream;
let facingMode = "user";

cameraButton.onclick = startCamera;
switchCameraButton.onclick = () => {
  facingMode = facingMode === "user" ? "environment" : "user";
  startCamera();
};

async function startCamera() {
  if (currentStream) currentStream.getTracks().forEach(t => t.stop());
  currentStream = await navigator.mediaDevices.getUserMedia({ video:{ facingMode } });
  frontCameraStream.srcObject = currentStream;
  frontCameraStream.style.display = "block";
  captureButton.style.display = "block";
}

captureButton.onclick = () => {
  photoCanvas.getContext("2d").drawImage(frontCameraStream,0,0,640,480);
  capturedPhoto.value = photoCanvas.toDataURL("image/png");
  frontCameraStream.style.display = "none";
  nextButtonStep1.style.display = "block";
};

nextButtonStep1.onclick = () => nextStep(2);

function nextStep(step){
  document.querySelector(".step-container.active").classList.remove("active");
  document.getElementById("step"+step).classList.add("active");
}

document.getElementById("registrationForm").addEventListener("submit", function(e){
  e.preventDefault();
  loadingSpinner.style.display = "block";

  const formData = new FormData();
  formData.append("firstName", firstName.value);
  formData.append("lastName", lastName.value);
  formData.append("dob", dob.value);
  formData.append("age", age.value);
  formData.append("currentSchool", city.value);
  formData.append("class", studentClass.value);
  formData.append("fatherName", fatherName.value);
  formData.append("motherName", motherName.value);
  formData.append("mobileNumber", mobileNumber.value);
  formData.append("email", email.value);
  formData.append("photoUrl", capturedPhoto.value);
  formData.append("signatureImage", "");
  formData.append("documentImage", "");

  fetch("https://script.google.com/macros/s/AKfycbyQWWhk5KQRkQgFIWlK8koLkJXd36sBUgwhnBb-dnGrIdepqhoAd1XBAxjwgdDfJqht/exec", {
    method: "POST",
    body: formData
  })
  .then(res => res.json())
  .then(data => {
    loadingSpinner.style.display = "none";
    if (data.status !== "success") {
      alert(data.message);
      return;
    }
    congratsScreen.style.display = "block";
    setTimeout(() => window.location.href = data.redirectUrl, 1000);
  })
  .catch(() => {
    loadingSpinner.style.display = "none";
    alert("Server error");
  });
});
</script>

</body>
</html>
